(function(){'use strict';const STORAGE_KEY = 'crex_theme_preference';const THEME_ATTRIBUTE = 'data-theme';const THEME_LIGHT = 'light';const THEME_DARK = 'dark';const THEME_AUTO = 'auto';let currentTheme = THEME_AUTO;let systemPreference = null;function detectSystemPreference(){if(window.matchMedia){return window.matchMedia('(prefers-color-scheme: dark)').matches ? THEME_DARK : THEME_LIGHT;}return THEME_LIGHT;}function getStoredPreference(){try{return localStorage.getItem(STORAGE_KEY)|| THEME_AUTO;}catch(e){return THEME_AUTO;}}function savePreference(theme){try{localStorage.setItem(STORAGE_KEY,theme);currentTheme = theme;}catch(e){console.warn('Impossible de sauvegarder la préférence du thème:',e);}}function getEffectiveTheme(){if(currentTheme === THEME_AUTO){return detectSystemPreference();}return currentTheme;}function applyTheme(theme){const effectiveTheme = theme === THEME_AUTO ? detectSystemPreference(): theme;const html = document.documentElement;html.classList.remove('dark-mode','light-mode');html.setAttribute(THEME_ATTRIBUTE,effectiveTheme);if(effectiveTheme === THEME_DARK){html.classList.add('dark-mode');}else{html.classList.add('light-mode');}const event = new CustomEvent('themechange',{detail:{theme: effectiveTheme,preference: currentTheme}});document.dispatchEvent(event);updateThemeToggleIcon(effectiveTheme);}function updateThemeToggleIcon(theme){const toggles = document.querySelectorAll('.theme-toggle,[data-theme-toggle]');toggles.forEach(toggle =>{const icon = toggle.querySelector('i');if(icon){if(theme === THEME_DARK){icon.className = 'fas fa-sun';}else{icon.className = 'fas fa-moon';}}});}function init(){currentTheme = getStoredPreference();systemPreference = detectSystemPreference();applyTheme(currentTheme);if(window.matchMedia){const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');mediaQuery.addEventListener('change',(e)=>{systemPreference = e.matches ? THEME_DARK : THEME_LIGHT;if(currentTheme === THEME_AUTO){applyTheme(THEME_AUTO);}});}document.body.classList.add('theme-transition-ready');document.addEventListener('click',(e)=>{const toggle = e.target.closest('.theme-toggle,[data-theme-toggle]');if(toggle){e.preventDefault();toggleTheme();}});window.DarkMode ={setTheme: setTheme,toggle: toggleTheme,getTheme:()=> currentTheme,getEffectiveTheme: getEffectiveTheme};}function setTheme(theme){if([THEME_LIGHT,THEME_DARK,THEME_AUTO].includes(theme)){savePreference(theme);applyTheme(theme);}}function toggleTheme(){const effectiveTheme = getEffectiveTheme();const newTheme = effectiveTheme === THEME_DARK ? THEME_LIGHT : THEME_DARK;setTheme(newTheme);}if(document.readyState === 'loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}})();